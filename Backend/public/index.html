<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Expense App</title>

  <style>
    body {
      font-family: system-ui;
      background: #f4f6f8;
      max-width: 420px;
      margin: auto;
      padding: 16px;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,.08);
    }

    input, select, button {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #ddd;
      margin-top: 8px;
      font-size: 16px;
    }

    button {
      background: #4f46e5;
      color: white;
      border: none;
      cursor: pointer;
    }

    button.delete {
      background: #ef4444;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      border-bottom: 1px solid #eee;
      padding: 10px 0;
    }

    h2, h3 {
      margin: 0 0 8px;
    }
  </style>
</head>

<body>

<div class="card">
  <h2>ğŸ’¸ à¸šà¸±à¸™à¸—à¸¶à¸à¸„à¹ˆà¸²à¹ƒà¸Šà¹‰à¸ˆà¹ˆà¸²à¸¢</h2>
  <div id="datetime"></div>

  <input id="text" placeholder="à¹€à¸Šà¹ˆà¸™ à¹à¸›à¹Šà¸šà¸‹à¸µà¹ˆ 25" />

  <select id="category">
    <option value="ğŸ½ à¸­à¸²à¸«à¸²à¸£">ğŸ½ à¸­à¸²à¸«à¸²à¸£</option>
    <option value="ğŸ¥¤ à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸”à¸·à¹ˆà¸¡">ğŸ¥¤ à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸”à¸·à¹ˆà¸¡</option>
    <option value="ğŸš— à¹€à¸”à¸´à¸™à¸—à¸²à¸‡">ğŸš— à¹€à¸”à¸´à¸™à¸—à¸²à¸‡</option>
    <option value="ğŸ›’ à¸‚à¸­à¸‡à¹ƒà¸Šà¹‰">ğŸ›’ à¸‚à¸­à¸‡à¹ƒà¸Šà¹‰</option>

    <!-- âœ… à¸­à¸·à¹ˆà¸™à¹† à¸à¸£à¹‰à¸­à¸¡à¸­à¸µà¹‚à¸¡à¸ˆà¸´ -->
    <option value="ğŸ“¦ à¸­à¸·à¹ˆà¸™à¹†">ğŸ“¦ à¸­à¸·à¹ˆà¸™à¹†</option>
  </select>

  <button onclick="add()">â• à¹€à¸à¸´à¹ˆà¸¡</button>
  <button class="delete" onclick="del()">ğŸ—‘ à¸¥à¸šà¸¥à¹ˆà¸²à¸ªà¸¸à¸”</button>
</div>

<div class="card">
  <h3 id="total">ğŸ“Š à¸£à¸§à¸¡à¸§à¸±à¸™à¸™à¸µà¹‰: 0 à¸šà¸²à¸—</h3>
  <ul id="list"></ul>
</div>

<script>
const textEl = document.getElementById("text")
const categoryEl = document.getElementById("category")
const listEl = document.getElementById("list")
const totalEl = document.getElementById("total")
const datetimeEl = document.getElementById("datetime")

async function add() {
  await fetch("/api/add-text", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      text: textEl.value,
      category: categoryEl.value
    })
  })

  textEl.value = ""
  load()
}

async function del() {
  await fetch("/api/delete-last", { method: "DELETE" })
  load()
}

async function load() {
  const list = await fetch("/api/today").then(r => r.json())
  const total = await fetch("/api/total").then(r => r.json())

  listEl.innerHTML = ""
  list.forEach(e => {
    listEl.innerHTML += `
      <li>
        ğŸ“… ${e.date} â° ${e.time}<br>
        ${e.category}<br>
        ğŸ½ ${e.item} â€” ğŸ’¸ ${e.price} à¸šà¸²à¸—
      </li>
    `
  })

  totalEl.innerText = `ğŸ“Š à¸£à¸§à¸¡à¸§à¸±à¸™à¸™à¸µà¹‰: ${total.total} à¸šà¸²à¸—`
}

async function loadTime() {
  const now = await fetch("/api/now").then(r => r.json())
  datetimeEl.innerText = `ğŸ“… ${now.date} â° ${now.time}`
}

load()
loadTime()
setInterval(loadTime, 1000)
</script>

</body>
</html>
